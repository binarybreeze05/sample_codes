<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutanix HCI Dashboard</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #0a0a0a;
      --muted: #6b7280; /* neutral-500 */
      --muted-600: #4b5563;
      --muted-700: #374151;
      --border: #e5e7eb; /* neutral-200 */
      --alt: #f5f5f5; /* neutral-100/50 */
      --accent: #0a0a0a;
      --accent-amber: #f59e0b;
      --accent-red: #ef4444;
      --shadow: 0 1px 2px rgba(0,0,0,0.05), 0 4px 12px rgba(0,0,0,0.06);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .container { max-width: 1360px; margin: 0 auto; padding: 24px; }
    /* Header */
    .header { position: sticky; top: 0; z-index: 10; backdrop-filter: blur(8px); background: rgba(255,255,255,0.9); border-bottom: 1px solid var(--border); }
    .header-inner { max-width: 1360px; margin: 0 auto; padding: 14px 24px; display: flex; align-items: center; justify-content: space-between; }
    .brand { display:flex; align-items:center; gap:10px; }
    .brand .logo {
      width:32px;
      height:32px;
      border-radius: 12px;
      background: url('logo.png') center/contain no-repeat;
    }
    .brand h1 { font-size: 18px; margin:0; font-weight: 600; letter-spacing: -0.01em; }

    .tabs { display:flex; gap:6px; background: var(--alt); padding:4px; border-radius: 999px; }
    .tab { padding:8px 14px; border-radius:999px; border:1px solid transparent; background: transparent; cursor: pointer; font-size: 13px; color: var(--muted-700); }
    .tab.active { background:#fff; box-shadow: var(--shadow); color: var(--text); }

    /* Section titles */
    h2.title { font-size: 20px; margin: 0 0 12px; font-weight: 600; letter-spacing: -0.01em; }

    /* Inputs */
    .filters { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; }
    @media (max-width: 900px) { .filters { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 560px) { .filters { grid-template-columns: 1fr; } }
    .field label { display:block; font-size:11px; color: var(--muted); margin-bottom:6px; }
    .input, select { width: 100%; height: 36px; border: 1px solid var(--border); border-radius: 12px; padding: 0 10px; background: #fff; outline: none; }
    .input:focus, select:focus { box-shadow: 0 0 0 3px rgba(0,0,0,0.06); }
    .bar { display:flex; align-items:center; gap:10px; margin-top: 10px; }
    .button { height: 36px; padding: 0 12px; border:1px solid var(--border); border-radius: 12px; background:#fff; cursor:pointer; }
    .button:disabled { opacity: .5; cursor: default; }

    /* Table */
    .card { border:1px solid var(--border); border-radius: var(--radius); overflow: hidden; background: #fff; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead { background: #f7f7f7; color: var(--muted-700); }
    th, td { text-align: left; padding: 10px 12px; }
    tbody tr { border-top: 1px solid #f1f1f1; }
    tbody tr:hover { background: #fafafa; }
    th.sortable { cursor: pointer; user-select: none; }
    th .arrow { font-size: 10px; margin-left: 4px; }

    .pagination { display:flex; align-items:center; justify-content: space-between; margin-top: 12px; font-size: 13px; }

    /* Cards grid */
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    @media (min-width: 1200px) { .grid { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    .cluster-card { text-align:left; border:1px solid var(--border); border-radius: 12px; padding:14px; background:#fff; transition: box-shadow .2s ease, transform .02s ease; cursor: pointer; }
    .cluster-card:hover { box-shadow: var(--shadow); }
    .row { display:flex; align-items:center; justify-content: space-between; gap: 10px; }
    .cluster-card > .row { margin-bottom: 12px; }
    .env { font-size: 12px; color: var(--muted); }
    .name { font-weight: 600; }
    .badges { display:flex; gap:8px; flex-wrap: wrap; }
    .badge { display:inline-flex; align-items:center; padding: 4px 10px; border-radius: 999px; border: 1px solid var(--border); font-size: 12px; color: var(--muted-700); background: #fafafa; }
    .badge.solid { background:#fff; color: var(--text); border-color: var(--text); }
    .desc { margin: 12px 0 16px; color: var(--muted-700); font-size: 13px; }
    .metrics { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:14px; }
    .metric { border:1px solid var(--border); border-radius: 12px; padding:14px; }
    .metric .label { font-size: 11px; color: var(--muted); margin-bottom: 6px; display:block; }
    .metric .value { margin-top: 4px; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
    .muted { color: var(--muted); font-size: 12px; }

    /* Progress */
    .progress { width: 100%; height: 8px; background: #e5e7eb; border-radius: 999px; overflow: hidden; }
    .progress > div { height: 100%; border-radius: 999px; background: var(--accent); }
    .progress.warn > div { background: var(--accent-amber); }
    .progress.danger > div { background: var(--accent-red); }

    /* Modal */
    .modal { position: fixed; inset: 0; z-index: 20; display:none; align-items: flex-end; justify-content: center; }
    @media (min-width: 640px) { .modal { align-items: center; } }
    .modal.active { display:flex; }
    .backdrop { position:absolute; inset:0; background: rgba(0,0,0,0.2); }
    .dialog { position: relative; width: min(1280px, 96vw); max-height: 88vh; overflow:auto; background:#fff; border-radius: 22px; padding: 24px; box-shadow: var(--shadow); }
    .dialog h3 { margin: 4px 0 6px; font-size: 18px; }

    .note { border:1px solid var(--border); background:#fafafa; padding: 12px 14px; border-radius: var(--radius); color: var(--muted-700); font-size: 13px; margin-top: 18px; }
    .section { margin: 28px 0; }

    /* Hide/show pages */
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo"></div>
        <h1>Nutanix HCI Dashboard</h1>
      </div>
      <div class="tabs">
        <button class="tab active" data-page="vms">VMs</button>
        <button class="tab" data-page="locations">Clusters</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- PAGE: VMs -->
    <section id="page-vms">
      <div class="filters">
        <div class="field">
          <label>VM Name</label>
          <input id="f-name" class="input" type="text" placeholder="Search by name…" />
        </div>
        <div class="field">
          <label>Major Type</label>
          <input id="f-major" class="input" type="text" placeholder="Search major type…" />
        </div>
        <div class="field">
          <label>Minor Type</label>
          <input id="f-minor" class="input" type="text" placeholder="Search minor type…" />
        </div>
        <div class="field">
          <label>Platform</label>
          <input id="f-platform" class="input" type="text" placeholder="Search platform…" />
        </div>
        <div class="field">
          <label>Platform Infrastructure Lead</label>
          <input id="f-lead" class="input" type="text" placeholder="Search lead…" />
        </div>
        <div class="field">
          <label>Supporting Team</label>
          <input id="f-team" class="input" type="text" placeholder="Search team…" />
        </div>
        <div class="field">
          <label>Host</label>
          <input id="f-host" class="input" type="text" placeholder="Search host…" />
        </div>
        <div class="field">
          <label>Cluster</label>
          <input id="f-cluster" class="input" type="text" placeholder="Search cluster…" />
        </div>
      </div>
      <div class="bar">
        <div class="muted">Showing <span id="count"></span> of <span id="total"></span> VMs</div>
        <div style="margin-left:auto"></div>
        <button id="clearFilters" class="button">Clear all filters</button>
      </div>

      <div class="card section">
        <table id="vm-table">
          <thead>
            <tr>
              <th class="sortable" data-key="name">VM Name <span class="arrow"></span></th>
              <th class="sortable" data-key="majorType">Major Type <span class="arrow"></span></th>
              <th class="sortable" data-key="minorType">Minor Type <span class="arrow"></span></th>
              <th class="sortable" data-key="platform">Platform <span class="arrow"></span></th>
              <th class="sortable" data-key="lead">Platform Infrastructure Lead <span class="arrow"></span></th>
              <th class="sortable" data-key="team">Supporting Team <span class="arrow"></span></th>
              <th class="sortable" data-key="host">Host <span class="arrow"></span></th>
              <th class="sortable" data-key="cluster">Cluster <span class="arrow"></span></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="pagination">
        <div>Page <strong id="pageNum">1</strong> of <span id="pageTotal">1</span></div>
        <div>
          <button id="prev" class="button">Previous</button>
          <button id="next" class="button">Next</button>
        </div>
      </div>
    </section>

    <!-- PAGE: Locations & Clusters -->
    <section id="page-locations" class="hidden">
      <h2 class="title">Clusters</h2>
      <div id="locations"></div>

      <div class="note">
        <strong>Note ·</strong> Our infrastructure is based on hyperconverged infrastructure (HCI), delivered through Nutanix. In each cluster, HCI pools all the storage across the nodes into one big shared pool at the cluster level. So instead of worrying about which server has which disk, the system treats it like one unified storage resource. If you add more nodes, both storage and compute grow automatically.
      </div>
    </section>
  </main>

  <!-- Cluster Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="backdrop" data-close></div>
    <div class="dialog">
      <div class="row">
        <div>
          <div class="env" id="modal-location"></div>
          <h3 id="modal-title"></h3>
          <div class="muted" id="modal-desc"></div>
        </div>
        <button class="button" data-close>✕</button>
      </div>

      <div class="metrics section" id="modal-metrics"></div>

      <div class="section">
        <div class="row" style="margin-bottom:6px;">
          <h3 class="title" style="margin:0;">Nodes</h3>
          <div class="muted" id="node-count"></div>
        </div>
        <div class="card">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Hypervisor</th>
                <th>Model</th>
                <th>CPU Usage</th>
                <th>CPU Capacity</th>
                <th>Memory Usage (inc. HA)</th>
                <th>Memory Capacity</th>
                <th>Storage (TB)</th>
                <th>HDD</th>
                <th>SSD</th>
                <th>VMs</th>
              </tr>
            </thead>
            <tbody id="nodes-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script type="text/csv" id="vm-data">
name,majorType,minorType,platform,lead,team,host,cluster
VM1,Type1,Minor1,Platform1,Lead1,Team1,Host1,Cluster1
VM2,Type2,Minor2,Platform2,Lead2,Team2,Host2,Cluster2
VM3,Type3,Minor3,Platform3,Lead3,Team3,Host3,Cluster3
VM4,Type4,Minor4,Platform1,Lead1,Team4,Host4,Cluster4
VM5,Type1,Minor5,Platform2,Lead2,Team1,Host5,Cluster5
VM6,Type2,Minor1,Platform3,Lead3,Team2,Host6,Cluster1
VM7,Type3,Minor2,Platform1,Lead1,Team3,Host1,Cluster2
VM8,Type4,Minor3,Platform2,Lead2,Team4,Host2,Cluster3
VM9,Type1,Minor4,Platform3,Lead3,Team1,Host3,Cluster4
VM10,Type2,Minor5,Platform1,Lead1,Team2,Host4,Cluster5
VM11,Type3,Minor1,Platform2,Lead2,Team3,Host5,Cluster1
VM12,Type4,Minor2,Platform3,Lead3,Team4,Host6,Cluster2
VM13,Type1,Minor3,Platform1,Lead1,Team1,Host1,Cluster3
VM14,Type2,Minor4,Platform2,Lead2,Team2,Host2,Cluster4
VM15,Type3,Minor5,Platform3,Lead3,Team3,Host3,Cluster5
VM16,Type4,Minor1,Platform1,Lead1,Team4,Host4,Cluster1
VM17,Type1,Minor2,Platform2,Lead2,Team1,Host5,Cluster2
VM18,Type2,Minor3,Platform3,Lead3,Team2,Host6,Cluster3
VM19,Type3,Minor4,Platform1,Lead1,Team3,Host1,Cluster4
VM20,Type4,Minor5,Platform2,Lead2,Team4,Host2,Cluster5
VM21,Type1,Minor1,Platform3,Lead3,Team1,Host3,Cluster1
VM22,Type2,Minor2,Platform1,Lead1,Team2,Host4,Cluster2
VM23,Type3,Minor3,Platform2,Lead2,Team3,Host5,Cluster3
VM24,Type4,Minor4,Platform3,Lead3,Team4,Host6,Cluster4
VM25,Type1,Minor5,Platform1,Lead1,Team1,Host1,Cluster5
VM26,Type2,Minor1,Platform2,Lead2,Team2,Host2,Cluster1
VM27,Type3,Minor2,Platform3,Lead3,Team3,Host3,Cluster2
VM28,Type4,Minor3,Platform1,Lead1,Team4,Host4,Cluster3
VM29,Type1,Minor4,Platform2,Lead2,Team1,Host5,Cluster4
VM30,Type2,Minor5,Platform3,Lead3,Team2,Host6,Cluster5
VM31,Type3,Minor1,Platform1,Lead1,Team3,Host1,Cluster1
VM32,Type4,Minor2,Platform2,Lead2,Team4,Host2,Cluster2
VM33,Type1,Minor3,Platform3,Lead3,Team1,Host3,Cluster3
VM34,Type2,Minor4,Platform1,Lead1,Team2,Host4,Cluster4
VM35,Type3,Minor5,Platform2,Lead2,Team3,Host5,Cluster5
VM36,Type4,Minor1,Platform3,Lead3,Team4,Host6,Cluster1
VM37,Type1,Minor2,Platform1,Lead1,Team1,Host1,Cluster2
VM38,Type2,Minor3,Platform2,Lead2,Team2,Host2,Cluster3
VM39,Type3,Minor4,Platform3,Lead3,Team3,Host3,Cluster4
VM40,Type4,Minor5,Platform1,Lead1,Team4,Host4,Cluster5
VM41,Type1,Minor1,Platform2,Lead2,Team1,Host5,Cluster1
VM42,Type2,Minor2,Platform3,Lead3,Team2,Host6,Cluster2
VM43,Type3,Minor3,Platform1,Lead1,Team3,Host1,Cluster3
VM44,Type4,Minor4,Platform2,Lead2,Team4,Host2,Cluster4
VM45,Type1,Minor5,Platform3,Lead3,Team1,Host3,Cluster5
VM46,Type2,Minor1,Platform1,Lead1,Team2,Host4,Cluster1
VM47,Type3,Minor2,Platform2,Lead2,Team3,Host5,Cluster2
VM48,Type4,Minor3,Platform3,Lead3,Team4,Host6,Cluster3
VM49,Type1,Minor4,Platform1,Lead1,Team1,Host1,Cluster4
VM50,Type2,Minor5,Platform2,Lead2,Team2,Host2,Cluster5
VM51,Type3,Minor1,Platform3,Lead3,Team3,Host3,Cluster1
VM52,Type4,Minor2,Platform1,Lead1,Team4,Host4,Cluster2
VM53,Type1,Minor3,Platform2,Lead2,Team1,Host5,Cluster3
VM54,Type2,Minor4,Platform3,Lead3,Team2,Host6,Cluster4
VM55,Type3,Minor5,Platform1,Lead1,Team3,Host1,Cluster5
VM56,Type4,Minor1,Platform2,Lead2,Team4,Host2,Cluster1
VM57,Type1,Minor2,Platform3,Lead3,Team1,Host3,Cluster2
VM58,Type2,Minor3,Platform1,Lead1,Team2,Host4,Cluster3
VM59,Type3,Minor4,Platform2,Lead2,Team3,Host5,Cluster4
VM60,Type4,Minor5,Platform3,Lead3,Team4,Host6,Cluster5
VM61,Type1,Minor1,Platform1,Lead1,Team1,Host1,Cluster1
VM62,Type2,Minor2,Platform2,Lead2,Team2,Host2,Cluster2
VM63,Type3,Minor3,Platform3,Lead3,Team3,Host3,Cluster3
VM64,Type4,Minor4,Platform1,Lead1,Team4,Host4,Cluster4
VM65,Type1,Minor5,Platform2,Lead2,Team1,Host5,Cluster5
VM66,Type2,Minor1,Platform3,Lead3,Team2,Host6,Cluster1
VM67,Type3,Minor2,Platform1,Lead1,Team3,Host1,Cluster2
VM68,Type4,Minor3,Platform2,Lead2,Team4,Host2,Cluster3
VM69,Type1,Minor4,Platform3,Lead3,Team1,Host3,Cluster4
VM70,Type2,Minor5,Platform1,Lead1,Team2,Host4,Cluster5
VM71,Type3,Minor1,Platform2,Lead2,Team3,Host5,Cluster1
VM72,Type4,Minor2,Platform3,Lead3,Team4,Host6,Cluster2
VM73,Type1,Minor3,Platform1,Lead1,Team1,Host1,Cluster3
VM74,Type2,Minor4,Platform2,Lead2,Team2,Host2,Cluster4
VM75,Type3,Minor5,Platform3,Lead3,Team3,Host3,Cluster5
VM76,Type4,Minor1,Platform1,Lead1,Team4,Host4,Cluster1
VM77,Type1,Minor2,Platform2,Lead2,Team1,Host5,Cluster2
VM78,Type2,Minor3,Platform3,Lead3,Team2,Host6,Cluster3
VM79,Type3,Minor4,Platform1,Lead1,Team3,Host1,Cluster4
VM80,Type4,Minor5,Platform2,Lead2,Team4,Host2,Cluster5
VM81,Type1,Minor1,Platform3,Lead3,Team1,Host3,Cluster1
VM82,Type2,Minor2,Platform1,Lead1,Team2,Host4,Cluster2
VM83,Type3,Minor3,Platform2,Lead2,Team3,Host5,Cluster3
VM84,Type4,Minor4,Platform3,Lead3,Team4,Host6,Cluster4
VM85,Type1,Minor5,Platform1,Lead1,Team1,Host1,Cluster5
VM86,Type2,Minor1,Platform2,Lead2,Team2,Host2,Cluster1
VM87,Type3,Minor2,Platform3,Lead3,Team3,Host3,Cluster2
VM88,Type4,Minor3,Platform1,Lead1,Team4,Host4,Cluster3
VM89,Type1,Minor4,Platform2,Lead2,Team1,Host5,Cluster4
VM90,Type2,Minor5,Platform3,Lead3,Team2,Host6,Cluster5
VM91,Type3,Minor1,Platform1,Lead1,Team3,Host1,Cluster1
VM92,Type4,Minor2,Platform2,Lead2,Team4,Host2,Cluster2
VM93,Type1,Minor3,Platform3,Lead3,Team1,Host3,Cluster3
VM94,Type2,Minor4,Platform1,Lead1,Team2,Host4,Cluster4
VM95,Type3,Minor5,Platform2,Lead2,Team3,Host5,Cluster5
VM96,Type4,Minor1,Platform3,Lead3,Team4,Host6,Cluster1
VM97,Type1,Minor2,Platform1,Lead1,Team1,Host1,Cluster2
VM98,Type2,Minor3,Platform2,Lead2,Team2,Host2,Cluster3
VM99,Type3,Minor4,Platform3,Lead3,Team3,Host3,Cluster4
VM100,Type4,Minor5,Platform1,Lead1,Team4,Host4,Cluster5

  </script>

  <script>
    // -----------------------------
    // Data Types & Sample Data
    // -----------------------------
    const SAMPLE_DATA = [
      {
        name: "Location1",
        description: "Description1",
        clusters: [
          {
            name: "Cluster1",
            env: "env1",
            description: "Description1",
            drCluster: "Cluster2",
            cpuUsagePct: 40,
            cpuCapacityGHz: 100,
            memUsagePctHA: 45,
            memCapacityTB: 5,
            storageCapacityTB: 50,
            storageUsagePct: 60,
            hddCount: 10,
            ssdCount: 5,
            hostCount: 2,
            vmCount: 30,
            hasFileServer: true,
            hasObjectsServer: false,
            nodes: [
              { name: "Node1", hypervisor: "Hypervisor1", model: "Model1", cpuUsagePct: 40, cpuCapacityGHz: 50, memUsagePctHA: 46, memCapacityTB: 2, storageCapacityTB: 20, hddCount: 4, ssdCount: 2, vmCount: 15 },
              { name: "Node2", hypervisor: "Hypervisor2", model: "Model2", cpuUsagePct: 42, cpuCapacityGHz: 50, memUsagePctHA: 47, memCapacityTB: 2, storageCapacityTB: 20, hddCount: 4, ssdCount: 2, vmCount: 15 },
            ]
          },
          {
            name: "Cluster2",
            env: "env2",
            description: "Description2",
            drCluster: "Cluster3",
            cpuUsagePct: 48,
            cpuCapacityGHz: 120,
            memUsagePctHA: 50,
            memCapacityTB: 6,
            storageCapacityTB: 60,
            storageUsagePct: 55,
            hddCount: 12,
            ssdCount: 6,
            hostCount: 2,
            vmCount: 32,
            hasFileServer: false,
            hasObjectsServer: true,
            nodes: [
              { name: "Node3", hypervisor: "Hypervisor1", model: "Model1", cpuUsagePct: 45, cpuCapacityGHz: 60, memUsagePctHA: 48, memCapacityTB: 2, storageCapacityTB: 22, hddCount: 5, ssdCount: 2, vmCount: 16 },
              { name: "Node4", hypervisor: "Hypervisor2", model: "Model2", cpuUsagePct: 47, cpuCapacityGHz: 60, memUsagePctHA: 49, memCapacityTB: 2, storageCapacityTB: 22, hddCount: 5, ssdCount: 2, vmCount: 16 },
            ]
          },
          {
            name: "Cluster3",
            env: "env3",
            description: "Description3",
            drCluster: "Cluster1",
            cpuUsagePct: 35,
            cpuCapacityGHz: 90,
            memUsagePctHA: 40,
            memCapacityTB: 4,
            storageCapacityTB: 40,
            storageUsagePct: 50,
            hddCount: 8,
            ssdCount: 4,
            hostCount: 2,
            vmCount: 28,
            hasFileServer: true,
            hasObjectsServer: true,
            nodes: [
              { name: "Node5", hypervisor: "Hypervisor1", model: "Model1", cpuUsagePct: 34, cpuCapacityGHz: 45, memUsagePctHA: 41, memCapacityTB: 1.5, storageCapacityTB: 18, hddCount: 4, ssdCount: 2, vmCount: 14 },
              { name: "Node6", hypervisor: "Hypervisor2", model: "Model2", cpuUsagePct: 36, cpuCapacityGHz: 45, memUsagePctHA: 42, memCapacityTB: 1.5, storageCapacityTB: 18, hddCount: 4, ssdCount: 2, vmCount: 14 },
            ]
          },
        ]
      },
      {
        name: "Location2",
        description: "Description2",
        clusters: [
          {
            name: "Cluster4",
            env: "env4",
            description: "Description4",
            drCluster: "Cluster5",
            cpuUsagePct: 52,
            cpuCapacityGHz: 130,
            memUsagePctHA: 55,
            memCapacityTB: 7,
            storageCapacityTB: 70,
            storageUsagePct: 62,
            hddCount: 14,
            ssdCount: 7,
            hostCount: 3,
            vmCount: 34,
            hasFileServer: true,
            hasObjectsServer: false,
            nodes: [
              { name: "Node7", hypervisor: "Hypervisor1", model: "Model1", cpuUsagePct: 50, cpuCapacityGHz: 65, memUsagePctHA: 53, memCapacityTB: 2, storageCapacityTB: 24, hddCount: 5, ssdCount: 2, vmCount: 17 },
              { name: "Node8", hypervisor: "Hypervisor2", model: "Model2", cpuUsagePct: 51, cpuCapacityGHz: 65, memUsagePctHA: 54, memCapacityTB: 2, storageCapacityTB: 24, hddCount: 5, ssdCount: 2, vmCount: 17 },
            ]
          },
          {
            name: "Cluster5",
            env: "env5",
            description: "Description5",
            drCluster: "Cluster4",
            cpuUsagePct: 38,
            cpuCapacityGHz: 95,
            memUsagePctHA: 42,
            memCapacityTB: 4,
            storageCapacityTB: 45,
            storageUsagePct: 48,
            hddCount: 9,
            ssdCount: 4,
            hostCount: 2,
            vmCount: 26,
            hasFileServer: false,
            hasObjectsServer: true,
            nodes: [
              { name: "Node9", hypervisor: "Hypervisor1", model: "Model1", cpuUsagePct: 37, cpuCapacityGHz: 48, memUsagePctHA: 43, memCapacityTB: 1.5, storageCapacityTB: 16, hddCount: 4, ssdCount: 2, vmCount: 13 },
              { name: "Node10", hypervisor: "Hypervisor2", model: "Model2", cpuUsagePct: 39, cpuCapacityGHz: 48, memUsagePctHA: 44, memCapacityTB: 1.5, storageCapacityTB: 16, hddCount: 4, ssdCount: 2, vmCount: 13 },
            ]
          },
        ]
      },
    ];

    // -----------------------------
    // Utilities
    // -----------------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function pctClass(p) {
      if (p < 70) return "";
      if (p < 85) return "warn";
      return "danger";
    }

    function parseVmCsv(text) {
      const lines = text.trim().split(/\r?\n/).filter(line=>line.trim().length);
      if (!lines.length) return [];
      const headers = lines.shift().split(',').map(h=>h.trim());
      const indexFor = key => headers.indexOf(key);
      const idx = {
        name: indexFor('name'),
        majorType: indexFor('majorType'),
        minorType: indexFor('minorType'),
        platform: indexFor('platform'),
        lead: indexFor('lead'),
        team: indexFor('team'),
        host: indexFor('host'),
        cluster: indexFor('cluster'),
      };
      return lines.map(line=>{
        const values = line.split(',').map(v=>v.trim());
        return {
          name: values[idx.name] || '',
          majorType: values[idx.majorType] || '',
          minorType: values[idx.minorType] || '',
          platform: values[idx.platform] || '',
          lead: values[idx.lead] || '',
          team: values[idx.team] || '',
          host: values[idx.host] || '',
          cluster: values[idx.cluster] || '',
        };
      });
    }

    function loadVMs() {
      const el = $('#vm-data');
      if (!el) return [];
      return parseVmCsv(el.textContent || el.innerText || '');
    }

    // -----------------------------
    // App State
    // -----------------------------
    const state = {
      activePage: 'vms',
      vms: [],
      filters: { name:'', majorType:'', minorType:'', platform:'', lead:'', team:'', host:'', cluster:'' },
      sortBy: 'name', sortDir: 'asc',
      page: 1, pageSize: 20,
      openCluster: null,
    };

    // -----------------------------
    // Initialization
    // -----------------------------
    function init() {
      state.vms = loadVMs();
      populateFilters();
      bindEvents();
      renderVMTable();
      renderLocations();
    }

    function populateFilters() {
      $('#total').textContent = state.vms.length;
    }

    function bindEvents() {
      // Tabs
      $$('.tab').forEach(btn=>btn.addEventListener('click', ()=>{
        $$('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        state.activePage = btn.dataset.page;
        $('#page-vms').classList.toggle('hidden', state.activePage !== 'vms');
        $('#page-locations').classList.toggle('hidden', state.activePage !== 'locations');
      }));

      // Filters
      $('#f-name').addEventListener('input', e=>{ state.filters.name = e.target.value; state.page=1; renderVMTable(); });
      $('#f-major').addEventListener('input', e=>{ state.filters.majorType = e.target.value; state.page=1; renderVMTable(); });
      $('#f-minor').addEventListener('input', e=>{ state.filters.minorType = e.target.value; state.page=1; renderVMTable(); });
      $('#f-platform').addEventListener('input', e=>{ state.filters.platform = e.target.value; state.page=1; renderVMTable(); });
      $('#f-lead').addEventListener('input', e=>{ state.filters.lead = e.target.value; state.page=1; renderVMTable(); });
      $('#f-team').addEventListener('input', e=>{ state.filters.team = e.target.value; state.page=1; renderVMTable(); });
      $('#f-host').addEventListener('input', e=>{ state.filters.host = e.target.value; state.page=1; renderVMTable(); });
      $('#f-cluster').addEventListener('input', e=>{ state.filters.cluster = e.target.value; state.page=1; renderVMTable(); });
      $('#clearFilters').addEventListener('click', ()=>{
        state.filters = { name:'', majorType:'', minorType:'', platform:'', lead:'', team:'', host:'', cluster:'' };
        $('#f-name').value='';
        ['f-major','f-minor','f-platform','f-lead','f-team','f-host','f-cluster'].forEach(id=>$('#'+id).value='');
        state.page = 1;
        renderVMTable();
      });

      // Sorting
      $$('#vm-table thead th.sortable').forEach(th=>{
        th.addEventListener('click', ()=>{
          const k = th.dataset.key;
          if (state.sortBy === k) state.sortDir = (state.sortDir==='asc'?'desc':'asc');
          else { state.sortBy = k; state.sortDir = 'asc'; }
          renderVMTable();
        });
      });

      // Pagination
      $('#prev').addEventListener('click', ()=>{ if (state.page>1){ state.page--; renderVMTable(); } });
      $('#next').addEventListener('click', ()=>{ const totalPages = Math.max(1, Math.ceil(filterVMs().length/state.pageSize)); if (state.page<totalPages){ state.page++; renderVMTable(); } });

      // Modal close
      $$('#modal [data-close]').forEach(el=>el.addEventListener('click', closeModal));
      document.addEventListener('keydown', (e)=>{ if (e.key==='Escape') closeModal(); });
    }

    // -----------------------------
    // VMs Page rendering
    // -----------------------------
    function filterVMs() {
      const f = state.filters;
      const match = (src, q) => !q || String(src).toLowerCase().includes(String(q).toLowerCase());
      return state.vms
        .filter(v=>match(v.name, f.name))
        .filter(v=>match(v.majorType, f.majorType))
        .filter(v=>match(v.minorType, f.minorType))
        .filter(v=>match(v.platform, f.platform))
        .filter(v=>match(v.lead, f.lead))
        .filter(v=>match(v.team, f.team))
        .filter(v=>match(v.host, f.host))
        .filter(v=>match(v.cluster, f.cluster))
        .sort((a,b)=>{
          const av = String(a[state.sortBy]).toLowerCase();
          const bv = String(b[state.sortBy]).toLowerCase();
          if (av<bv) return state.sortDir==='asc'? -1:1;
          if (av>bv) return state.sortDir==='asc'? 1:-1;
          return 0;
        });
    }

    function renderVMTable() {
      const rows = filterVMs();
      $('#count').textContent = rows.length;
      const totalPages = Math.max(1, Math.ceil(rows.length/state.pageSize));
      if (state.page>totalPages) state.page = totalPages;
      $('#pageTotal').textContent = totalPages;
      $('#pageNum').textContent = state.page;
      $('#prev').disabled = state.page===1;
      $('#next').disabled = state.page===totalPages;

      const pageItems = rows.slice((state.page-1)*state.pageSize, state.page*state.pageSize);
      const tbody = $('#vm-table tbody');
      tbody.innerHTML = pageItems.map(v=>`
        <tr>
          <td class="name">${escapeHtml(v.name)}</td>
          <td>${escapeHtml(v.majorType)}</td>
          <td>${escapeHtml(v.minorType)}</td>
          <td>${escapeHtml(v.platform)}</td>
          <td>${escapeHtml(v.lead)}</td>
          <td>${escapeHtml(v.team)}</td>
          <td>${escapeHtml(v.host)}</td>
          <td>${escapeHtml(v.cluster)}</td>
        </tr>`).join('')
        || `<tr><td colspan="8" class="muted" style="text-align:center; padding:24px;">No results. Try adjusting filters.</td></tr>`;

      // Update sort arrows
      $$('#vm-table thead th .arrow').forEach(a=>a.textContent='');
      const activeTh = $(`#vm-table thead th[data-key="${state.sortBy}"] .arrow`);
      if (activeTh) activeTh.textContent = state.sortDir==='asc' ? '▲' : '▼';
    }

    // -----------------------------
    // Locations Page rendering
    // -----------------------------
    function renderLocations() {
      const root = $('#locations');
      root.innerHTML = '';
      for (const loc of SAMPLE_DATA) {
        const section = document.createElement('div');
        section.className = 'section';
        section.innerHTML = `
          <div class="row" style="align-items:baseline; margin-bottom:8px;">
            <div>
              <h3 class="title" style="margin-bottom:4px;">${escapeHtml(loc.name)}</h3>
              <div class="muted">${escapeHtml(loc.description)}</div>
            </div>
          </div>
          <div class="grid"></div>
        `;
        const grid = $('.grid', section);
        for (const cl of loc.clusters) {
          const card = document.createElement('button');
          card.className = 'cluster-card';
          card.innerHTML = `
            <div class="row">
              <div>
                <div class="name">${escapeHtml(cl.name)}</div>
              </div>
              <div class="badges">
                <span class="badge">DR: ${escapeHtml(cl.drCluster)}</span>
              </div>
            </div>
            <div class="desc">${escapeHtml(cl.description)}</div>
            <div class="metrics">
              <div class="metric">
                <div class="label">CPU Usage</div>
                <div class="value">${cl.cpuUsagePct}%</div>
                <div class="progress ${pctClass(cl.cpuUsagePct)}"><div style="width:${cl.cpuUsagePct}%"></div></div>
                <div class="muted" style="margin-top:4px;">Capacity: ${cl.cpuCapacityGHz} GHz</div>
              </div>
              <div class="metric">
                <div class="label">Memory Usage (inc. HA)</div>
                <div class="value">${cl.memUsagePctHA}%</div>
                <div class="progress ${pctClass(cl.memUsagePctHA)}"><div style="width:${cl.memUsagePctHA}%"></div></div>
                <div class="muted" style="margin-top:4px;">Capacity: ${cl.memCapacityTB} TB</div>
              </div>
              <div class="metric">
                <div class="label">Physical Storage Usage</div>
                <div class="value">${cl.storageUsagePct}%</div>
                <div class="progress ${pctClass(cl.storageUsagePct)}"><div style="width:${cl.storageUsagePct}%"></div></div>
                <div class="muted" style="margin-top:4px;">Capacity: ${cl.storageCapacityTB} TB</div>
                <div class="muted">HDD: ${cl.hddCount} · SSD: ${cl.ssdCount}</div>
              </div>
              <div class="metric">
                <div class="label">Entities</div>
                <div class="muted">Hosts: ${cl.hostCount} · VMs: ${cl.vmCount}</div>
              </div>
            </div>
          `;
          card.addEventListener('click', ()=>openClusterModal(loc.name, cl));
          grid.appendChild(card);
        }
        root.appendChild(section);
      }
    }

    // -----------------------------
    // Modal (Cluster → Nodes)
    // -----------------------------
    function openClusterModal(locationName, cluster) {
      state.openCluster = { locationName, cluster };
      $('#modal-location').textContent = locationName;
      $('#modal-title').textContent = cluster.name;
      $('#modal-desc').textContent = cluster.description;

      // Top metrics
      const m = cluster;
      $('#modal-metrics').innerHTML = `
        <div class="metric">
          <div class="label">CPU Usage</div>
          <div class="value">${m.cpuUsagePct}%</div>
          <div class="progress ${pctClass(m.cpuUsagePct)}"><div style="width:${m.cpuUsagePct}%"></div></div>
          <div class="muted" style="margin-top:4px;">Capacity: ${m.cpuCapacityGHz} GHz</div>
        </div>
        <div class="metric">
          <div class="label">Memory Usage (inc. HA)</div>
          <div class="value">${m.memUsagePctHA}%</div>
          <div class="progress ${pctClass(m.memUsagePctHA)}"><div style="width:${m.memUsagePctHA}%"></div></div>
          <div class="muted" style="margin-top:4px;">Capacity: ${m.memCapacityTB} TB</div>
        </div>
        <div class="metric">
          <div class="label">Physical Storage Usage</div>
          <div class="value">${m.storageUsagePct}%</div>
          <div class="progress ${pctClass(m.storageUsagePct)}"><div style="width:${m.storageUsagePct}%"></div></div>
          <div class="muted" style="margin-top:4px;Capacity: ${m.storageCapacityTB} TB</div>
          <div class="muted">HDD: ${m.hddCount} · SSD: ${m.ssdCount}</div>
        </div>
        <div class="metric">
          <div class="label">Entities</div>
          <div class="muted">Hosts: ${m.hostCount} · VMs: ${m.vmCount}</div>
        </div>`;

      // Nodes table
      const tbody = $('#nodes-body');
      $('#node-count').textContent = `${cluster.nodes.length} total`;
      tbody.innerHTML = cluster.nodes.map(n=>`
        <tr>
          <td class="name">${escapeHtml(n.name)}</td>
          <td>${escapeHtml(n.hypervisor)}</td>
          <td>${escapeHtml(n.model)}</td>
          <td>
            <div class="row" style="gap:8px;">
              <div class="progress ${pctClass(n.cpuUsagePct)}" style="flex:1"><div style="width:${n.cpuUsagePct}%"></div></div>
              <span class="muted" style="width:36px; text-align:right;">${n.cpuUsagePct}%</span>
            </div>
          </td>
          <td>${n.cpuCapacityGHz} GHz</td>
          <td>
            <div class="row" style="gap:8px;">
              <div class="progress ${pctClass(n.memUsagePctHA)}" style="flex:1"><div style="width:${n.memUsagePctHA}%"></div></div>
              <span class="muted" style="width:36px; text-align:right;">${n.memUsagePctHA}%</span>
            </div>
          </td>
          <td>${n.memCapacityTB} TB</td>
          <td>${n.storageCapacityTB}</td>
          <td>${n.hddCount}</td>
          <td>${n.ssdCount}</td>
          <td>${n.vmCount}</td>
        </tr>
      `).join('');

      // Show modal
      $('#modal').classList.add('active');
      $('#modal').setAttribute('aria-hidden','false');
    }

    function closeModal(){
      $('#modal').classList.remove('active');
      $('#modal').setAttribute('aria-hidden','true');
      state.openCluster = null;
    }

    // Escape HTML helper
    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // Boot
    init();
  </script>
</body>
</html>
